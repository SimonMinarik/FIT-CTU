{% extends 'base.html' %}

{% block head %}
<title>Movie recommender</title>
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.13/css/jquery.dataTables.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>
<style>
* {box-sizing: border-box;}

.container {
  position: relative;
  width: 50%;
  max-width: 300px;
}

.image {
  display: block;
  width: 100%;
  height: auto;
}

.overlay {
  position: absolute;
  bottom: 0;
  background: rgb(0, 0, 0);
  background: rgba(0, 0, 0, 0.5); /* Black see-through */
  color: #f1f1f1;
  width: 300px;
  transition: .5s ease;
  opacity:0;
  color: white;
  font-size: 20px;
  padding: 20px;
  text-align: center;
}

.container:hover .overlay {
  opacity: 1;
}
</style>
{% endblock %}

{% block body %}
<div>
    <form action="/" method="POST" style="text-align: center">
        <button type="submit" name="recommender" value="recommender">Movie Recommender</button>
    </form>
    <script>
        var user = {{user|tojson}}
        var movies = {{movies|tojson}}
        document.write("<center><h3>Ratings of user: ", user["username"], "</h3></center>")
    </script>
    <table id="example" class="display" width="100%" cellspacing="0">
        <thead>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <script>
            var x = 0
            var items = Object.keys(user["ratings"]).map(function(key) {
              return [key, user["ratings"][key]];
            });
            items.sort(function(first, second) {
              return second[1] - first[1];
            });
            for (i = 0; i < items.length; i++) {
                if (x === 0) {
                    document.write("<tr>")
                }
                x += 1
                document.write("<th><div class=\"container\"><img class=\"image\" style=\"width: 300px; height: 400px;\" src=\"http://image.tmdb.org/t/p/original" + movies[items[i][0]].poster + "\"/>\n" +
                    "<div class=\"overlay\">\n" +
                    "<div>" + movies[items[i][0]].overview + "</div></div></div>\n" +
                    "<div style=\"text-align:center\">" + movies[items[i][0]].title + "</div>\n" +
                    "<div style=\"text-align:center\">Your rating: ")
                document.write("<form action=\"/change_rating/" + user["username"] + "/" + items[i][0] + "\" method=\"POST\" style=\"text-align: center\">\n" +
                    "<select name=\"myselect\" id=\"myselect\" onchange=\"this.form.submit()\">")
                for (j = 0.0; j < 5.5; j += 0.5) {
                    if (j == items[i][1]) {
                        document.write("<option value=\" " + j +" \" selected>" + j + "</option>")
                    } else {
                        document.write("<option value=\" " + j +" \">" + j + "</option>")
                    }
                }
                document.write("<option value=\"Delete\">Delete</option></select></form>")
                document.write("</div></th>")
                if (x === 5) {
                    document.write("</tr>")
                    x = 0
                }
            }
            if (x > 0) {
                for (i = 0; i < 5-x; i++) {
                    document.write("<th></th>")
                }
                document.write("</tr>")
            }
        </script>
        </tbody>
    </table>
    <script>
        document.write("<center><h3>Recommendations for user: ", user["username"], "</h3></center>")
        recommendations = {{recommendations|tojson}}
    </script>
    <h4 style="text-align: center">Time with preprocessing the data: {{time_preprocess}} s</h4>
    <h4 style="text-align: center">Time after preprocessing the data: {{time_cosine}} s</h4>
    <table id="example2" class="display" width="100%" cellspacing="0">
        <thead>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <script>
            var x = 0
            var items = Object.keys(recommendations).map(function(key) {
              return [key, recommendations[key]];
            });
            items.sort(function(first, second) {
              return second[1] - first[1];
            });
            for (i = 0; i < items.length; i++) {
                if (x === 0) {
                    document.write("<tr>")
                }
                x += 1
                document.write("<th><div class=\"container\"><img class=\"image\" style=\"width: 300px; height: 400px;\" src=\"http://image.tmdb.org/t/p/original" + movies[items[i][0]].poster + "\"/>\n" +
                    "<div class=\"overlay\">\n" +
                    "<div>" + movies[items[i][0]].overview + "</div></div></div>\n" +
                    "<div style=\"text-align:center\">" + movies[items[i][0]].title + "</div>\n" +
                    "<div style=\"text-align:center\">Score: " + items[i][1] + "</div>" +
                    "<div style=\"text-align:center\">Rate the movie: </div>")
                document.write("<form action=\"/add_rating/" + user["username"] + "/" + items[i][0] + "\" method=\"POST\" style=\"text-align: center\">\n" +
                    "<select name=\"myselect\" id=\"myselect\" onchange=\"this.form.submit()\">")
                for (j = 0.0; j < 5.5; j += 0.5) {
                    document.write("<option value=\" " + j +" \">" + j + "</option>")
                }
                document.write("</select></form>")
                    document.write("</th>")
                if (x === 5) {
                    document.write("</tr>")
                    x = 0
                }
            }
            if (x > 0) {
                for (i = 0; i < 5-x; i++) {
                    document.write("<th></th>")
                }
                document.write("</tr>")
            }
        </script>
        </tbody>
    </table>
       <script>
        document.write("<center><h3>All movies:</h3></center>")
    </script>
    <table id="example3" class="display" width="100%" cellspacing="0">
        <thead>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <script>
            var seen_movies = Object.keys(user["ratings"])
            for (movie in movies) {
                if (seen_movies.indexOf(movie) === -1) {
                    if (x === 0) {
                    document.write("<tr>")
                }
                x += 1
                document.write("<th><div class=\"container\"><img class=\"image\" style=\"width: 300px; height: 400px;\" src=\"http://image.tmdb.org/t/p/original" + movies[movie].poster + "\"/>\n" +
                    "<div class=\"overlay\">\n" +
                    "<div>" + movies[movie].overview + "</div></div></div>\n" +
                    "<div style=\"text-align:center\">" + movies[movie].title + "</div>\n" +
                    "<div style=\"text-align:center\">Rate the movie: </div>")
                    document.write("<form action=\"/add_rating/" + user["username"] + "/" + movie + "\" method=\"POST\" style=\"text-align: center\">\n" +
                    "<select name=\"myselect\" id=\"myselect\" onchange=\"this.form.submit()\">")
                for (j = 0.0; j < 5.5; j += 0.5) {
                    document.write("<option value=\" " + j +" \">" + j + "</option>")
                }
                document.write("</select></form>")
                    document.write("</th>")
                if (x === 5) {
                    document.write("</tr>")
                    x = 0
                }
                }
            }
            if (x > 0) {
                for (i = 0; i < 5-x; i++) {
                    document.write("<th></th>")
                }
                document.write("</tr>")
            }
        </script>
        </tbody>
    </table>
    <script>
    $(document).ready(function() {
    $('#example').DataTable( {
        "pagingType": "full_numbers",
        "ordering": false,
        "searching": false,
        pageLength: 1,
        "bLengthChange": false,
        "bInfo" : false
    } );
} );
    $(document).ready(function() {
    $('#example2').DataTable( {
        "pagingType": "full_numbers",
        "ordering": false,
        "searching": false,
        pageLength: 1,
        "bLengthChange": false,
        "bInfo" : false
    } );
} );
    $(document).ready(function() {
    $('#example3').DataTable( {
        "pagingType": "full_numbers",
        "ordering": false,
        "searching": true,
        pageLength: 2,
        "bLengthChange": false,
        "bInfo" : false
    } );
} );
</script>
</div>
{% endblock %}